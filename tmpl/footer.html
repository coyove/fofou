
<div id="footer" style="padding: 6px 0; text-align: center; font-size: 12px; line-height:1.5em">
    Rendered in {{.RenderTime}}ms by
    <a href="https://github.com/coyove/fofou" target="_blank">fofou</a><a href="/mod">2</a>
    <a href="#" onclick="_deleteMode(this)">删除模式</a>
</div>

<div style="cursor:pointer;background:rgba(0,0,0,0.2);position:fixed;width:24px;height:24px;line-height:24px;text-align:center;top:50%;right:0">
    <span class="icon-down-dir" onclick="$([document.documentElement,document.body]).animate({scrollTop:$('#footer').offset().top},100)">
    </span>
</div>
</div>

<script>
    function _deleteMode(el) {
        var m = document.cookie.match(/'ID':\[(\S+)\]/);
        var id = null;
        if (m && m[1]) {
            var a = new Uint8Array(m[1].split("^"));
            id = (btoa(String.fromCharCode.apply(null, a)).substring(0, 8).replace("+", "-").replace("/", "_"));
        }
        if (!id) return;

        $(".post .info").each(function(i, el) {
            if ($(el).find(".author").text() != id) return;

            $(el).append($("<div>")
                .append($("<button>").text("删除")
                    .on("click", (function (el) {
                        return function() {
                            var id = $(el).parent().get(0).id.match(/post-(\d+)/)[1];
                            _reply(id, true);
                        }
                    })(el)))
            );
        });
        $(el).hide();
    }

    (function() {
        var s = JSON.parse(localStorage.getItem("fold") || '{}'), latest = 0;
        for (var id in s) {
            _togglePost(id);
            if (s[id] > latest) latest = s[id];
        }
        for (var id in s) {
            if (latest - s[id] > 7 * 24 * 3600 * 1000) delete s[id];
        }
        if ((localStorage.getItem("auto-expand") || "off") == "on") {
            $('#expand-newpost').click();
        }
        var m = document.cookie.match(/'M':(\d+)/);
        if (m && m[1]) {
            if ((parseInt(m[1]) & 1) == 0) $(".admin-topic-ops").hide();
        }
        $(document).mouseup(function(e) {
            var menu = $(".dropdown.active");
            if (!menu.get(0)) return;
            if (!menu.is(e.target) && menu.has(e.target).length === 0) menu.click();
        });
    })()
</script>

</body>
</html>
