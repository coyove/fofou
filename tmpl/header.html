<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{.Title}}</title>
        <link href="/s/default.css" rel="stylesheet" type="text/css">
        <link href="/s/fontello-embedded.css" rel="stylesheet" type="text/css">
        <script src="/s/jquery-1.12.4.min.js"></script>
    </head>

    <script>
        function _ref(el, id) {
            if ($(el).prop('expanded')) return;
            $(el).prop("expanded", true);
            $.get("/p/" + id, function (data) {
                var div = $("<div>").addClass('ref');
                div.html(data);
                $(el).after(div);
            });
        }
function _enlarge(el, url) {
    var m = localStorage.getItem("image-view") || 'expand';
    if (m === 'expand') {
        if ($(el).prop('expanded')) {
            $(el).addClass('image').removeClass('image-large').prop('expanded', false);
        } else {
            $(el).removeClass('image').addClass('image-large').attr('src', url).prop('expanded', true);
        }
    } else {
        window.open(url);
    }
}
        function _togglePost(id) {
            var p = $("#post-" + id + " .toggle");
            if (!p.get(0)) return;

            var c = p.prop("fold");
            var m = $("#post-" + id + " .message");
            var s = JSON.parse(localStorage.getItem("fold") || '{}');
            var cls = (localStorage.getItem("hide-looks") || 'gray') == 'gray' ? 'fold' : 'fold fold-hide';

            p.prop("fold", !c).removeClass("icon-plus-squared icon-minus-squared").addClass(c ? "icon-minus-squared" : "icon-plus-squared");
            if (c) {
                m.show().parent().removeClass(cls);
                delete s[id];
            } else {
                m.hide().parent().addClass(cls);
                s[id] = new Date().getTime();
            }
            localStorage.setItem("fold", JSON.stringify(s));
        }
        function _submit(btn, msg) {
            btn ? $(btn).prop('disabled', 'true') : 0;
            var form = new FormData();
            if (msg) {
                form.append('message', msg);
            } else {
                form.append('subject', $('#subject').val());
                form.append('message', $('#message').val());
                form.append('image', $('#select-image').get(0).files[0]);
                form.append('topic', window.TOPIC_ID || 0);
                form.append('uuid', $('#newpost').attr('uuid'));
                form.append('sage', ($('#sage').get(0) || {}).checked ? "sage" : "");
                try {
                    form.append('token', grecaptcha.getResponse());
                } catch (ex) {}
            }
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(e) {
                if ( 4 == this.readyState ) {
                    try {
                        var resp = xhr.responseText;
                        resp = JSON.parse(resp);
                        if (resp.success) {
                            location.reload();
                            return;
                        }
                        alert("发生错误：\ncode: " + resp.error + "\n" + ({
                            "bad-request": "无效请求 ",
                            "internal-error": "内部错误",
                            "recaptcha-needed": "请完成验证",
                            "recaptcha-failed": "验证失败，请刷新页面重试",
                            "no-more-new-users": "未持有cookie的匿名用户无法发言",
                            "message-too-short": "正文内容过短",
                            "topic-locked": "主题已被锁定",
                            "image-upload-failed": "图片上传失败",
                            "image-upload-disabled": "禁止上传图片",
                            "image-invalid-format": "图片格式不支持",
                            "image-disk-error": "图片上传失败",
                        })[resp.error]);
                    } catch (ex) {
                        alert("发生错误：\n" + ex);
                        console.error(resp);
                    }

                }
                btn ? $(btn).prop('disabled', '') : 0;
            };
            xhr.open('post', "/api");
            xhr.send(form);
        }
    </script>

    <body>
        <div id="container"> 
            <div class="header">
                <a class="item" href="/">主页</a>      
                <a class="item" href="/list">搜索</a>
                <a class="item" href="/rss.xml">RSS</a>
                <a class="item" href="/status">状态</a>
            </div>
