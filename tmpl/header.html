<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>{{ .Title }}</title>
        <link href="/s/default.css" rel="stylesheet" type="text/css">
        <script src="/s/jquery-1.12.4.min.js"></script>
    </head>

    <script>
        function _togglePost(id) {
            var p = $("#post-" + id + " .toggle"), c = p.prop("fold");
            var m = $("#post-" + id + " .message");
            var s = JSON.parse(localStorage.getItem("fold") || '{}');
            p.prop("fold", !c).text(c ? "[-]" : "[+]");
            if (c) {
                m.show().parent().removeClass("fold");
                delete s[id];
            } else {
                m.hide().parent().addClass("fold");
                s[id] = new Date().getTime();
            }
            localStorage.setItem("fold", JSON.stringify(s));
        }
        function _submit(btn, msg) {
            btn ? $(btn).prop('disabled', 'true') : 0;
            var form = new FormData();
            if (msg) {
                form.append('message', msg);
            } else {
                form.append('subject', $('#subject').val());
                form.append('message', $('#message').val());
                form.append('image', $('#select-image').get(0).files[0]);
                form.append('topic', window.TOPIC_ID || 0);
                form.append('token', grecaptcha.getResponse());
            }
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function(e) {
                if ( 4 == this.readyState ) {
                    try {
                        var resp = xhr.responseText;
                        resp = JSON.parse(resp);
                        if (resp.success) {
                            location.reload();
                            return;
                        }
                        alert("发生错误：\ncode: " + resp.error);
                    } catch (ex) {
                        alert("发生错误：\n" + ex);
                        console.error(resp);
                    }

                }
                btn ? $(btn).prop('disabled', '') : 0;
            };
            xhr.open('post', "/api");
            xhr.send(form);
        }
    </script>

    <body>
        <div id="container"> 
            <div class="header">
                <a class="item" href="/">主页</a>        
            </div>
